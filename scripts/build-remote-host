#!/usr/bin/env sh

show_help() {
  echo "Usage: $(basename "$0") <command> <target-host> <flake>"
  echo
  echo "Arguments:"
  echo "  <command>       nixos-rebuild command (e.g., switch, boot, test)"
  echo "  <target-host>   SSH host for the target system"
  echo "  <flake>         Path or URL to the Nix flake"
  echo
  echo "Example:"
  echo "  $(basename "$0") switch user@remote-host /path#hostname"
}

# Check if help is requested or arguments are missing
if [ "$1" = "-h" ] || [ "$1" = "--help" ] || [ $# -ne 3 ]; then
  show_help
  exit 1
fi

nixos-rebuild "$1" \
  --target-host "$2" \
  --build-host localhost \
  --flake "$3"

